# AI Auto Poster Lite (Box) プラグインの詳細説明

## 概要

このプラグインは、WordPressで自動的にAGA（男性型脱毛）に関する記事を生成するためのツールです。OpenAIのAPIを使用して、記事の題材、本文、およびアイキャッチ画像を自動生成します。

## 主な機能

1. AGAに関する記事の自動生成
2. Gutenbergブロックエディタ対応のコンテンツ生成
3. アイキャッチ画像の自動生成（オプション）
4. 管理画面からの簡単操作

## プラグインの構造解説

### 1. プラグイン基本設定 (1-8行目)

```php
/**
 * Plugin Name: AI Auto Poster Lite (Box)
 * Description: 最小構成。OpenAIのJSONをGutenbergブロックへ変換...
 * Version: 0.3.1
 * Author: You
 */
```

- プラグインの基本情報を定義
- WordPressプラグインとして認識されるために必要なヘッダー情報

### 2. クラス定義と定数 (10-14行目)

```php
class AIAP_Lite_Box {
    const OPT_KEY       = 'aiap_lite_settings';
    const ACTION_RUN    = 'aiap_lite_run';
    const NOTICE_KEY    = 'aiap_lite_notice';
```

- `OPT_KEY`: プラグイン設定の保存用キー
- `ACTION_RUN`: 実行アクションの識別子
- `NOTICE_KEY`: 通知メッセージの一時保存用キー

### 3. 初期化処理 (15-22行目)

- WordPressの各種フックに機能を登録
- サムネイル機能の有効化
- 管理メニューの追加
- スタイルの追加

### 4. 管理画面の設定 (33-76行目)

- プラグイン設定ページの作成
- 以下の設定項目を提供：
  - OpenAI APIキー
  - 投稿ステータス（公開/下書き）
  - アイキャッチ画像生成オプション
  - 画像生成のヒント設定

### 5. 実行処理の流れ (116-274行目)

1. **題材生成** (130-163行目)

   - OpenAIにAGAに関する記事のテーマを生成させる
   - タイトル、切り口、アウトライン（見出し）を取得

2. **本文生成** (166-229行目)

   - 生成された題材をもとに記事本文を生成
   - 見出し、段落、リスト、ボックスなどの要素を含む

3. **アイキャッチ画像生成** (240-265行目)
   - OpenAIのImage生成APIを使用
   - 記事のテーマに合わせた画像を生成

### 6. OpenAI API通信 (276-330行目)

- `openai_json`: テキスト生成API呼び出し
- `openai_image`: 画像生成API呼び出し

### 7. 画像処理機能 (331-400行目)

- 生成された画像の保存
- WordPressメディアライブラリへの登録
- アイキャッチ画像としての設定

### 8. Gutenbergブロック変換 (402-490行目)

- JSONデータをWordPressのブロックエディタ形式に変換
- 対応するブロックタイプ：
  - 見出し（h2, h3, h4）
  - 段落
  - リスト
  - カスタムボックス

### 9. スタイル定義 (102-114行目)

```css
/* カスタムデザイン要素のCSS */
.under-line-yellow { ... }
.under-line-pink { ... }
.box_001 { ... }
.point-box { ... }
```

- 記事内で使用される装飾用のスタイル定義
- 下線やボックスなどのデザイン要素

## 使用方法

1. プラグインをインストールして有効化
2. 設定ページ（AI Auto Poster Lite）にアクセス
3. OpenAI APIキーを設定
4. 必要に応じて他の設定を調整
5. 「今すぐ実行」ボタンで記事を生成

## 注意点

1. OpenAI APIキーが必要
2. APIの利用には料金が発生する可能性あり
3. 生成される内容は自動生成のため、公開前の確認推奨
4. アイキャッチ画像生成はオプション機能

## エラーハンドリング

- APIキー未設定時のエラー表示
- 画像生成失敗時の適切なエラーメッセージ
- 記事生成プロセスの各段階でのエラーチェック

## セキュリティ対策

- WordPressの権限チェック
- データのサニタイズ処理
- APIキーの安全な保存

## カスタマイズポイント

1. 記事テーマの調整（132-134行目）
2. 記事構成の変更（168-206行目）
3. スタイルのカスタマイズ（102-114行目）
4. 画像生成プロンプトの調整（332-342行目）

このプラグインは、AGAクリニックのブログ記事作成を自動化することで、コンテンツ作成の効率を大幅に向上させることができます。
